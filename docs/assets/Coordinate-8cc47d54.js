import{g as M}from"./index-4243d227.js";import{_ as E,r as S,o as P,b as R,c as T,p as b,e as Y,d as X}from"./index-f31fb122.js";const k=p=>(b("data-v-8dad3c3e"),p=p(),Y(),p),B=k(()=>X("span",{class:"tip"},"请点击创建圆形，页面支持缩放",-1)),I=[B],W={__name:"Coordinate",setup(p){const u=S(null);return P(()=>{const d=u.value,m=d.getBoundingClientRect();class v{constructor(t=[1,0,0,1,0,0]){this.m=t&&t.slice()||[1,0,0,1,0,0]}updateMatrix(t){this.m=t.slice()}point(t){var s=this.m;return{x:s[0]*t.x+s[2]*t.y+s[4],y:s[1]*t.x+s[3]*t.y+s[5]}}multiply(t){var s=this.m[0]*t[0]+this.m[2]*t[1],e=this.m[1]*t[0]+this.m[3]*t[1],a=this.m[0]*t[2]+this.m[2]*t[3],i=this.m[1]*t[2]+this.m[3]*t[3],n=this.m[0]*t[4]+this.m[2]*t[5]+this.m[4],h=this.m[1]*t[4]+this.m[3]*t[5]+this.m[5];return this.m[0]=s,this.m[1]=e,this.m[2]=a,this.m[3]=i,this.m[4]=n,this.m[5]=h,this}invert(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),s=this.m[3]*t,e=-this.m[1]*t,a=-this.m[2]*t,i=this.m[0]*t,n=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),h=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=s,this.m[1]=e,this.m[2]=a,this.m[3]=i,this.m[4]=n,this.m[5]=h,this}getMatrix(){return this.m}}class y{constructor(t){this.domElement=document.createElement("canvas"),this.ctx=this.domElement.getContext("2d"),this.setCanvasSize(t),this.setCanvasAttrs(),this.ctx.scale(t.pixel,t.pixel)}setCanvasSize(t){const{width:s,height:e,pixel:a}=t;this.width=s*a,this.height=e*a,this.styleWidth=s,this.styleHeight=e}setCanvasAttrs(){const{width:t,height:s,styleWidth:e,styleHeight:a,domElement:i}=this;i.width=t,i.height=s,i.style.cssText=`width:${e}px;height:${a}px;`}}class f{constructor(t){this.color=t.color,this.radius=t.radius,this.transform=new v,this.changeTransform(t)}changeTransform(t){this.transform.updateMatrix([1,0,0,1,t.x,t.y])}render(t){const{radius:s,color:e}=this;t.fillStyle=e,t.beginPath(),t.arc(0,0,s,0,2*Math.PI,!1),t.fill(),t.closePath()}}class _{constructor(t){const{width:s,height:e,container:a}=t;this.content=a,this.width=s,this.height=e,this.transform=new v,this.children=[],this.canvas=new y({pixel:window.devicePixelRatio,width:s,height:e}),this.mountCanvas()}mountCanvas(){this.content.appendChild(this.canvas.domElement)}changeTransform(t){this.transform.updateMatrix([t.scaleX,0,0,t.scaleY,t.translateX,t.translateY])}getTranslation(){const t=this.transform.getMatrix();return{x:t[4],y:t[5]}}getScale(){const t=this.transform.getMatrix();return{x:t[0],y:t[3]}}getRelativePointerPosition(t){const s=this.transform.getMatrix(),e=new v(s);return e.invert(),e.point(t)}add(t){this.children.push(t)}render(){const{width:t,height:s,children:e,canvas:a}=this,{ctx:i}=a,n=this.transform.getMatrix();i.clearRect(0,0,t,s);for(const h of e){const c=new v;c.multiply(n),c.multiply(h.transform.getMatrix()),i.save();const o=c.getMatrix();i.transform(o[0],o[1],o[2],o[3],o[4],o[5]),h.render(i),i.restore()}}}const l=new _({container:d,width:m.width,height:m.height}),x=1.01,w=r=>{r.preventDefault();const{pageX:t,pageY:s,deltaY:e}=r,a=t-m.left,i=s-m.top,{x:n}=l.getScale(),h=l.getTranslation(),c=e>0?n*x:n/x,o={x:(a-h.x)/n,y:(i-h.y)/n},g={x:a-o.x*c,y:i-o.y*c};l.changeTransform({scaleX:c,scaleY:c,translateX:g.x,translateY:g.y}),l.render()},C=r=>{const t=l.getRelativePointerPosition({x:r.pageX-m.left,y:r.pageY-m.top});l.add(new f({x:t.x,y:t.y,radius:30,color:M()})),l.render()};d.addEventListener("wheel",w,{passive:!1}),d.addEventListener("click",C)}),(d,m)=>(R(),T("div",{class:"box",ref_key:"boxElementRef",ref:u},I,512))}},H=E(W,[["__scopeId","data-v-8dad3c3e"]]);export{H as default};
