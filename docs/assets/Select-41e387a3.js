import{g as x}from"./index-4243d227.js";import{r as M,o as R,b as _,c as K}from"./index-472deb67.js";const q={__name:"Select",setup(H){const f=M(null);return R(()=>{const l=f.value,a=l.getBoundingClientRect(),r=new Map,w=()=>{for(;;){const h=x();if(!r.has(h))return h}},C=(h,t,e)=>((1<<24)+(h<<16)+(t<<8)+e).toString(16).slice(1);class v{constructor(t){this.id=t.id,this.x=t.x,this.y=t.y,this.color=t.color,this.radius=t.radius,this.colorKey=w(),r.set(this.colorKey,this)}render(t,e){const{radius:s,color:i,x:o,y:n,colorKey:u,id:m}=this;t.save(),t.fillStyle=e?u:i,t.beginPath(),t.arc(o,n,s,0,2*Math.PI,!1),t.fill(),e||(t.fillStyle="#fff",t.font="20px Georgia",t.fillText(m,o,n)),t.closePath(),t.restore()}}class S{constructor(t){this.id=t.id,this.x=t.x,this.y=t.y,this.color=t.color,this.width=t.width,this.height=t.height,this.colorKey=w(),r.set(this.colorKey,this)}render(t,e=!1){const{color:s,x:i,y:o,width:n,height:u,colorKey:m,id:E}=this;t.save(),t.fillStyle=e?m:s,t.beginPath(),t.rect(i,o,n,u),t.fill(),e||(t.fillStyle="#fff",t.font="20px Georgia",t.fillText(E,i+n/3,o+u/3)),t.closePath(),t.restore()}}class g{constructor(t){this.domElement=document.createElement("canvas"),this.ctx=this.domElement.getContext("2d",{willReadFrequently:!!t.willReadFrequently}),this.setCanvasSize(t),this.setCanvasAttrs(),this.ctx.scale(t.pixel,t.pixel)}setCanvasSize(t){const{width:e,height:s,pixel:i}=t;this.width=e*i,this.height=s*i,this.styleWidth=e,this.styleHeight=s}setCanvasAttrs(){const{width:t,height:e,styleWidth:s,styleHeight:i,domElement:o}=this;o.width=t,o.height=e,o.style.cssText=`width:${s}px;height:${i}px;`}}class b{constructor(t){const{width:e,height:s,container:i}=t;this.content=i,this.width=e,this.height=s,this.children=[],this.canvas=new g({pixel:window.devicePixelRatio,width:e,height:s}),this.bufferHitCanvas=new g({pixel:1,width:e,height:s,willReadFrequently:!0}),this.mountCanvas()}mountCanvas(){this.content.appendChild(this.canvas.domElement)}add(t){this.children.push(t)}getSelectedShape(t){const s=this.bufferHitCanvas.ctx.getImageData(Math.round(t.x),Math.round(t.y),1,1).data;if(s[3]===255){const o=`#${C(s[0],s[1],s[2])}`.toUpperCase();if(r.has(o))return r.get(o)}}render(){const{children:t,canvas:e,bufferHitCanvas:s}=this,{ctx:i}=e,{ctx:o}=s;i.clearRect(0,0,this.width,this.height);for(const n of t)n.render(i),n.render(o,!0)}}const p=a.width,y=a.height,c=new b({container:l,width:p,height:y});let d=0;for(let h=0;h<10;h++){d+=1;const t=new S({id:d,x:Math.random()*p,y:Math.random()*y,width:60,height:60,color:x()});d+=1;const e=new v({id:d,x:Math.random()*p,y:Math.random()*y,radius:30,color:x()});c.add(e),c.add(t)}c.render(),l.addEventListener("click",h=>{const t={x:h.pageX-a.left,y:h.pageY-a.top},e=c.getSelectedShape(t),s=e?`选中的图形ID是：${e.id}`:"没有选中图形";alert(s)})}),(l,a)=>(_(),K("div",{class:"box",ref_key:"boxElementRef",ref:f},null,512))}};export{q as default};
