import{g as M}from"./index-4243d227.js";import{_ as E,r as S,o as P,b as R,c as T,p as Y,e as X,d as k}from"./index-9a21a5d4.js";const B=u=>(Y("data-v-e1e4b15b"),u=u(),X(),u),I=B(()=>k("span",{class:"tip"},"请点击创建圆形，页面支持缩放",-1)),W=[I],H={__name:"Coordinate",setup(u){const g=S(null);return P(()=>{const p=g.value,o=p.getBoundingClientRect();class x{constructor(t=[1,0,0,1,0,0]){this.m=t&&t.slice()||[1,0,0,1,0,0]}updateMatrix(t){this.m=t.slice()}point(t){var s=this.m;return{x:s[0]*t.x+s[2]*t.y+s[4],y:s[1]*t.x+s[3]*t.y+s[5]}}multiply(t){var s=this.m[0]*t[0]+this.m[2]*t[1],e=this.m[1]*t[0]+this.m[3]*t[1],a=this.m[0]*t[2]+this.m[2]*t[3],i=this.m[1]*t[2]+this.m[3]*t[3],n=this.m[0]*t[4]+this.m[2]*t[5]+this.m[4],r=this.m[1]*t[4]+this.m[3]*t[5]+this.m[5];return this.m[0]=s,this.m[1]=e,this.m[2]=a,this.m[3]=i,this.m[4]=n,this.m[5]=r,this}invert(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),s=this.m[3]*t,e=-this.m[1]*t,a=-this.m[2]*t,i=this.m[0]*t,n=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),r=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=s,this.m[1]=e,this.m[2]=a,this.m[3]=i,this.m[4]=n,this.m[5]=r,this}getMatrix(){return this.m}}class f{constructor(t){this.domElement=document.createElement("canvas"),this.ctx=this.domElement.getContext("2d"),this.setCanvasSize(t),this.setCanvasAttrs(),this.ctx.scale(t.pixel,t.pixel)}setCanvasSize(t){const{width:s,height:e,pixel:a}=t;this.width=s*a,this.height=e*a,this.styleWidth=s,this.styleHeight=e}setCanvasAttrs(){const{width:t,height:s,styleWidth:e,styleHeight:a,domElement:i}=this;i.width=t,i.height=s,i.style.cssText=`width:${e}px;height:${a}px;`}}class _{constructor(t){this.color=t.color,this.radius=t.radius,this.transform=new x,this.changeTransform(t)}changeTransform(t){this.transform.updateMatrix([1,0,0,1,t.x,t.y])}render(t){const{radius:s,color:e}=this;t.fillStyle=e,t.beginPath(),t.arc(0,0,s,0,2*Math.PI,!1),t.fill(),t.closePath()}}class w{constructor(t){const{width:s,height:e,container:a}=t;this.content=a,this.width=s,this.height=e,this.transform=new x,this.children=[],this.canvas=new f({pixel:window.devicePixelRatio,width:s,height:e}),this.mountCanvas()}mountCanvas(){this.content.appendChild(this.canvas.domElement)}changeTransform(t){this.transform.updateMatrix([t.scaleX,0,0,t.scaleY,t.translateX,t.translateY])}getTranslation(){const t=this.transform.getMatrix();return{x:t[4],y:t[5]}}getScale(){const t=this.transform.getMatrix();return{x:t[0],y:t[3]}}getRelativePointerPosition(t){const s=this.transform.getMatrix(),e=new x(s);return e.invert(),e.point(t)}add(t){this.children.push(t)}render(){const{width:t,height:s,children:e,canvas:a}=this,{ctx:i,width:n,height:r}=a,m=this.transform.getMatrix();i.clearRect(0,0,n,r);for(const v of e){const l=new x;l.multiply(m),l.multiply(v.transform.getMatrix()),i.save();const d=l.getMatrix();i.transform(d[0],d[1],d[2],d[3],d[4],d[5]),v.render(i),i.restore()}}}const c=new w({container:p,width:o.width,height:o.height}),y=1.01,C=h=>{h.preventDefault();const{pageX:t,pageY:s,deltaY:e}=h,a=t-o.left,i=s-o.top,{x:n}=c.getScale(),r=c.getTranslation(),m=e>0?n*y:n/y,v={x:(a-r.x)/n,y:(i-r.y)/n},l={x:a-v.x*m,y:i-v.y*m};c.changeTransform({scaleX:m,scaleY:m,translateX:l.x,translateY:l.y}),c.render()},b=h=>{const t=c.getRelativePointerPosition({x:h.pageX-o.left,y:h.pageY-o.top});c.add(new _({x:t.x,y:t.y,radius:30,color:M()})),c.render()};p.addEventListener("wheel",C,{passive:!1}),p.addEventListener("click",b)}),(p,o)=>(R(),T("div",{class:"box",ref_key:"boxElementRef",ref:g},W,512))}},L=E(H,[["__scopeId","data-v-e1e4b15b"]]);export{L as default};
