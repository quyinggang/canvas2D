import{_ as D,r as L,o as M,a as A,b as P,c as X,d as F}from"./index-472deb67.js";const Y={class:"box"},$={__name:"Table",setup(q){const C=L(null);return M(()=>{const T=C.value;class S{constructor(e){this.domElement=document.createElement("canvas"),this.ctx=this.domElement.getContext("2d"),this.setCanvasSize(e),this.setCanvasAttrs(),this.ctx.scale(e.pixel,e.pixel)}setCanvasSize(e){const{width:t,height:n,pixel:o}=e;this.width=t*o,this.height=n*o,this.styleWidth=t,this.styleHeight=n}setCanvasAttrs(){const{width:e,height:t,styleWidth:n,styleHeight:o,domElement:i}=this;i.width=e,i.height=t,i.style.cssText=`width:${n}px;height:${o}px;`}}class E{constructor(e){this.x=e.x,this.y=e.y,this.scene=e.scene,this.columns=e.columns,this.data=e.data,this.defaultConfig={headerBackground:"#20D9F0",lineColor:"#0696B4",headLineHeight:40,bodyLineHeight:30,scrollBarWidth:6,scrollBarColor:"#0696B4"},this.scrollTop=0,this.renderDataStartIndex=0,this.renderDataEndIndex=0,this.cacheContext=null,this.raf=null,this.computeTableSize(e),this.computeClientDataRange(),this.bindEvents()}computeTableSize(e){const{data:t,defaultConfig:n,columns:o}=this,{width:i,height:s}=e,{headLineHeight:a,bodyLineHeight:l}=n,d=t.length;this.tableSize={tableWidth:i,tableHeight:s,cellWidth:Math.floor(i/o.length),headerHeight:a,realBodyHeight:d*l,clientBodyHeight:s-a}}computeClientDataRange(){const{scrollTop:e,data:t,defaultConfig:n,tableSize:o}=this,i=n.bodyLineHeight,s=e?Math.floor(e/i):0,a=Math.ceil(o.clientBodyHeight/i);this.renderDataStartIndex=Math.max(s-1,0),this.renderDataEndIndex=Math.min(s+a,t.length-1)}render(e){const{x:t,y:n}=this;this.cacheContext=e,e.save(),e.translate(t,n),this.drawHeaderBackground(e),this.drawBorder(e),this.drawHeader(e),this.drawBody(e),this.drawScrollBar(e),e.restore()}drawHeaderBackground(e){const{tableSize:t,defaultConfig:n}=this;e.save(),e.rect(0,0,t.tableWidth,t.headerHeight),e.fillStyle=n.headerBackground,e.fill(),e.restore()}drawBorder(e){const{tableSize:t,defaultConfig:n}=this,{tableWidth:o,tableHeight:i}=t;e.save(),e.strokeStyle=n.lineColor,e.beginPath(),e.moveTo(0,0),e.lineTo(o,0),e.lineTo(o,i),e.lineTo(0,i),e.lineTo(0,0),e.stroke(),e.closePath(),e.restore()}drawHeader(e){const{columns:t,tableSize:n,defaultConfig:o}=this,{cellWidth:i,headerHeight:s,tableWidth:a,tableHeight:l}=n,d=t.length,p={x:i*.5,y:s*.5};e.save(),e.font="12px serif",e.strokeStyle=o.lineColor,e.textAlign="center",e.textBaseline="middle";for(let c=0;c<d;c++){const m=t[c].name,r=i*(c+1);e.moveTo(r,0),e.lineTo(r,l),e.stroke();const y=i*c;e.fillText(m,y+p.x,p.y)}e.beginPath(),e.moveTo(0,s),e.lineTo(a,s),e.stroke(),e.restore()}drawBody(e){const{columns:t,defaultConfig:n,data:o,tableSize:i,renderDataStartIndex:s,renderDataEndIndex:a}=this,{tableWidth:l,cellWidth:d,headerHeight:p,clientBodyHeight:c}=i,m=t.length,r=n.bodyLineHeight,y={x:d*.5,y:r*.5};e.save(),e.translate(0,p),e.rect(0,0,l,c),e.clip(),e.translate(0,-this.scrollTop),e.font="12px serif",e.strokeStyle=n.lineColor,e.textAlign="center",e.textBaseline="middle";const u=s,g=a+1;for(let h=u;h<g;h++){const v=o[h],H=r*h,B=h+1;if(B<=g){const f=r*B;e.moveTo(0,f),e.lineTo(l,f),e.stroke()}for(let f=0;f<m;f++){const W=t[f].field,R=d*f,z=v[W];e.fillText(z,R+y.x,H+y.y)}}e.restore()}drawScrollBar(e){const{defaultConfig:t,tableSize:n,scrollTop:o}=this,{scrollBarWidth:i,headLineHeight:s,bodyLineHeight:a}=t,{clientBodyHeight:l,realBodyHeight:d,tableWidth:p}=n,c=d-l;if(c<=0)return;const m=i/2;let r=l/d*l;r=Math.max(a-i,r);const y=l-r-i,u=Math.floor(o*y/c),g={x:p-m,y:m+u},h={x:g.x,y:g.y+r};e.save(),e.translate(0,s),e.lineWidth=i,e.lineCap="round",e.strokeStyle=t.scrollBarColor,e.beginPath(),e.moveTo(g.x,g.y),e.lineTo(h.x,h.y),e.stroke(),e.restore()}scroll(){const{x:e,y:t,tableSize:n,cacheContext:o}=this;this.computeClientDataRange(),o.clearRect(e,t,n.tableWidth,n.tableHeight),this.render(o)}bindEvents(){const{x:e}=this,{clientBodyHeight:t,realBodyHeight:n,headerHeight:o,tableWidth:i,tableHeight:s}=this.tableSize,a=n-t;if(a<=0)return;const{content:l,bounding:d}=this.scene,p={start:{x:e,y:o},end:{x:e+i,y:o+s}},c=.1;let m=!1;const r=y=>{const u=this.scrollTop,g=u+y*c,h=Math.min(Math.max(0,Math.ceil(g)),a);this.scrollTop=h,u!==h&&this.scroll()};this.handleWheel=y=>{y.preventDefault();const{clientX:u,clientY:g,deltaY:h}=y,v=u-d.left,H=g-d.top,B=v>=p.start.x&&v<=p.end.x,f=H>=p.start.y&&H<=p.end.y;B&&f&&(m||(m=!0,this.raf=window.requestAnimationFrame(()=>{r(h),m=!1})))},l.addEventListener("wheel",this.handleWheel)}destroy(){const{content:e}=this.scene;window.cancelAnimationFrame(this.raf),e.removeEventListener("wheel",this.handleWheel)}}class I{constructor(e){this.content=e.container;const t=this.content.getBoundingClientRect();this.children=[],this.canvas=new S({pixel:window.devicePixelRatio,width:t.width,height:t.height}),this.bounding=t,this.mountCanvas()}mountCanvas(){this.content.appendChild(this.canvas.domElement)}add(e){this.children.push(e)}render(){const{children:e,canvas:t,bounding:n}=this,o=t.ctx;o.clearRect(0,0,n.width,n.height);for(const i of e)i.render(o)}}const k=[{province:"浙江",city:"杭州",type:"笔",price:1},{province:"浙江",city:"杭州",type:"纸张",price:2},{province:"浙江",city:"舟山",type:"笔",price:3},{province:"浙江",city:"舟山",type:"纸张",price:4},{province:"吉林",city:"长春",type:"笔",price:5},{province:"吉林",city:"白山",type:"笔",price:6},{province:"河南",city:"洛阳",type:"纸张",price:7},{province:"河南",city:"郑州",type:"笔",price:8},{province:"江苏",city:"南京",type:"纸张",price:9},{province:"上海",city:"上海",type:"纸张",price:10}],_=[];for(let b=0;b<5;b++)_.push(...k);const w=new I({container:T}),x=new E({x:10,y:10,width:400,height:300,scene:w,columns:[{field:"province",name:"省份"},{field:"city",name:"城市"},{field:"type",name:"类型"},{field:"price",name:"价格"}],data:_});w.add(x),w.render(),A(()=>x.destroy())}),(T,S)=>(P(),X("div",Y,[F("div",{class:"center",ref_key:"boxElementRef",ref:C},null,512)]))}},O=D($,[["__scopeId","data-v-0776e482"]]);export{O as default};
