import{g as P}from"./index-894cb8bb.js";import{_ as S,r as E,o as M,b as T,c as b,p as k,e as Y,d as X}from"./index-b7bb8ac5.js";const B=v=>(k("data-v-e5e01da2"),v=v(),Y(),v),I=B(()=>X("span",{class:"tip"},"请点击创建圆形，页面支持缩放",-1)),W=[I],V={__name:"Coordinate",setup(v){const u=E(null);return M(()=>{const p=u.value,l=p.getBoundingClientRect();class x{constructor(t=[1,0,0,1,0,0]){this.m=t&&t.slice()||[1,0,0,1,0,0]}updateMatrix(t){this.m=t.slice()}point(t){var s=this.m;return{x:s[0]*t.x+s[2]*t.y+s[4],y:s[1]*t.x+s[3]*t.y+s[5]}}multiply(t){var s=this.m[0]*t[0]+this.m[2]*t[1],e=this.m[1]*t[0]+this.m[3]*t[1],n=this.m[0]*t[2]+this.m[2]*t[3],i=this.m[1]*t[2]+this.m[3]*t[3],a=this.m[0]*t[4]+this.m[2]*t[5]+this.m[4],c=this.m[1]*t[4]+this.m[3]*t[5]+this.m[5];return this.m[0]=s,this.m[1]=e,this.m[2]=n,this.m[3]=i,this.m[4]=a,this.m[5]=c,this}invert(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),s=this.m[3]*t,e=-this.m[1]*t,n=-this.m[2]*t,i=this.m[0]*t,a=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),c=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=s,this.m[1]=e,this.m[2]=n,this.m[3]=i,this.m[4]=a,this.m[5]=c,this}getMatrix(){return this.m}}class w{constructor(t){this.domElement=document.createElement("canvas"),this.ctx=this.domElement.getContext("2d"),this.setCanvasSize(t),this.setCanvasAttrs(),this.ctx.scale(t.pixel,t.pixel)}getTransform(){return this.ctx.getTransform()}setCanvasSize(t){const{width:s,height:e,pixel:n}=t;this.width=s*n,this.height=e*n,this.styleWidth=s,this.styleHeight=e}setCanvasAttrs(){const{width:t,height:s,styleWidth:e,styleHeight:n,domElement:i}=this;i.width=t,i.height=s,i.style.cssText=`width:${e}px;height:${n}px;`}}class f{constructor(t){this.x=t.x,this.y=t.y,this.color=t.color,this.radius=t.radius,this.transform=new x}render(t){const{x:s,y:e,radius:n,color:i}=this;t.fillStyle=i,t.beginPath(),t.arc(s,e,n,0,2*Math.PI,!1),t.fill(),t.closePath()}}class _{constructor(t){const{width:s,height:e,container:n}=t;this.content=n,this.width=s,this.height=e,this.transform=new x,this.children=[],this.canvas=new w({pixel:window.devicePixelRatio,width:s,height:e}),this.mountCanvas()}mountCanvas(){this.content.appendChild(this.canvas.domElement)}changeTransform(t){this.transform.updateMatrix([t.scaleX,0,0,t.scaleY,t.translateX,t.translateY])}getTranslation(){const t=this.transform.getMatrix();return{x:t[4],y:t[5]}}getScale(){const t=this.transform.getMatrix();return{x:t[0],y:t[3]}}getRelativePointerPosition(t){const s=this.transform.getMatrix(),e=new x(s);return e.invert(),e.point(t)}add(t){this.children.push(t)}renderViewportRect(t){const{canvas:s,width:e,height:n}=this,i=s.ctx,a=new x(t);a.invert();const c={x:0,y:0},o={x:e,y:n},r=a.point(c),d=a.point(o);console.log(r,d);const y={x:r.x,y:r.y,width:d.x-r.x,height:d.y-r.y};i.lineWidth=2,i.strokeStyle="red",i.strokeRect(y.x,y.y,y.width,y.height)}render(){const{width:t,height:s,children:e,canvas:n}=this,{ctx:i}=n,a=this.transform.getMatrix(),o=new x().multiply(a).getMatrix();i.clearRect(0,0,t,s),i.save(),i.transform(o[0],o[1],o[2],o[3],o[4],o[5]),this.renderViewportRect(o);for(const r of e)r.render(i);i.restore()}}const m=new _({container:p,width:l.width,height:l.height}),g=1.01,C=h=>{h.preventDefault();const{pageX:t,pageY:s,deltaY:e}=h,n=t-l.left,i=s-l.top,{x:a}=m.getScale(),c=m.getTranslation(),o=e>0?a*g:a/g,r={x:(n-c.x)/a,y:(i-c.y)/a},d={x:n-r.x*o,y:i-r.y*o};m.changeTransform({scaleX:o,scaleY:o,translateX:d.x,translateY:d.y}),m.render()},R=h=>{const t={x:h.pageX-l.left,y:h.pageY-l.top},s=m.getRelativePointerPosition(t);m.add(new f({x:s.x,y:s.y,radius:30,color:P()})),m.render()};p.addEventListener("wheel",C,{passive:!1}),p.addEventListener("click",R)}),(p,l)=>(T(),b("div",{class:"box",ref_key:"boxElementRef",ref:u},W,512))}},H=S(V,[["__scopeId","data-v-e5e01da2"]]);export{H as default};
