import{r as q,o as z,b as D,c as G}from"./index-081d04d0.js";const O={__name:"Chart",setup(J){const C=q(null);return z(()=>{const R=C.value;class M{constructor(t,s){this.defaultConfig={pixelRatio:window.devicePixelRatio,width:400,height:300,gridMargin:{top:40,bottom:40,left:100,right:80},space:30},this.option=s,this.rootElement=t,this.canvas=this.createCanvas(),this.ctx=this.canvas.getContext("2d"),this.mountCanvas()}createCanvas(){const{width:t,height:s,pixelRatio:e}=this.defaultConfig,o=document.createElement("canvas");return o.width=t*e,o.height=s*e,o.style.cssText=`width:${t}px;height:${s}px`,o}mountCanvas(){this.rootElement.appendChild(this.canvas)}processInfo(){const{defaultConfig:t,option:s}=this,{width:e,height:o,pixelRatio:c,gridMargin:n,space:h}=t,{top:i,bottom:r,left:g,right:x}=n,b=e*c,l=o*c,{xAxisField:y,yAxisField:T,series:u,showBackground:I}=s,_=u.length,B=[],E=[],P=[],F=[],S=[],d={x:g,y:l-r},A={x:b-x,y:l-r},p=l-i-r,V=Math.floor((A.x-d.x)/_),v=[1e3,2e3,3e3,4e3],W=Math.max(...v),X=Math.floor(p/v.length);for(let a=0;a<=_;a++){const f=u[a],w={x:d.x+a*V,y:d.y};if(f){const m=f[y],$=f[T],H=Math.floor($/W*p)-1,k={x:w.x+h,y:i+p-H,width:V-h*2,height:H};if(E.push(m),F.push(k),I){const j={x:k.x,y:i,width:k.width,height:p};S.push(j)}}B.push(w)}for(let a=0,f=v.length;a<f;a++){const w=v[a],m=d.y-(a+1)*X;P.push({start:{x:d.x,y:m},end:{x:A.x,y:m},value:w})}return{start:d,end:A,bars:F,backgrounds:S,ticks:B,xAxis:E,yAxis:P}}drawRect(t,s){const e=this.ctx;e.save(),e.fillStyle=s,e.moveTo(t.x,t.y),e.fillRect(t.x,t.y,t.width,t.height),e.restore()}drawText(t,s,e){const o=this.ctx,c=o.measureText(t).width,n={x:Math.floor(s.x+(e.x-s.x)/2-c/2),y:s.y+25};o.moveTo(n.x,n.y),o.fillText(t,n.x,n.y)}drawAxisTick(t){const s=this.ctx;s.moveTo(t.x,t.y),s.lineTo(t.x,t.y+8)}drawXAxis(t,s){const e=this.ctx;e.moveTo(t.x,t.y),e.lineTo(s.x,s.y)}drawYAxis(t,s){const{ctx:e,defaultConfig:o}=this,{left:c}=o.gridMargin,n=c-15;e.save(),e.beginPath(),e.textAlign="right",e.strokeStyle="rgb(225,230,240)";for(const h of t){const{start:i,end:r,value:g}=h;e.moveTo(i.x,i.y),e.lineTo(r.x,r.y),e.fillText(g,n,i.y+6)}e.fillText("0",n,s.y+6),e.stroke(),e.closePath(),e.restore()}renderBackground(t,s){for(let e=0;e<s;e++){const o=t[e];o&&this.drawRect(o,"rgb(244,244,244)")}}render(){const{ctx:t,option:s}=this,{showBackground:e}=s,{start:o,end:c,ticks:n,xAxis:h,yAxis:i,bars:r,backgrounds:g}=this.processInfo();t.save(),t.font="20px serif",e&&this.renderBackground(g,n.length),this.drawYAxis(i,o),t.beginPath(),this.drawXAxis(o,c);for(let x=0,b=n.length;x<b;x++){const l=n[x],y=n[x+1],T=h[x],u=r[x];this.drawAxisTick(l),u&&this.drawRect(u,"rgb(89,113,192)"),y&&this.drawText(T,l,y)}t.stroke(),t.closePath(),t.restore()}}const Y={xAxisField:"day",yAxisField:"value",showBackground:!0,series:[{day:"周一",value:1e3},{day:"周二",value:2e3},{day:"周三",value:4e3},{day:"周四",value:2500},{day:"周五",value:3e3}]};new M(R,Y).render()}),(R,M)=>(D(),G("div",{class:"box",ref_key:"boxElementRef",ref:C},null,512))}};export{O as default};
