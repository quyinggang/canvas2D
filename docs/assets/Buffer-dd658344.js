import{a as r}from"./index-4243d227.js";import{r as g,o as w,a as C,b as y,c as b}from"./index-f31fb122.js";const R={__name:"Buffer",setup(E){const o=g(null);return w(()=>{const d=o.value;class l{constructor(t){this.radius=t,this.width=t*2+2,this.height=t*2+2,this.canvas=this.createCanvas(),this.ctx=this.canvas.getContext("2d"),this.cache()}createCanvas(){const{width:t,height:e}=this,s=document.createElement("canvas");return s.width=t,s.height=e,s}cache(){const{ctx:t,radius:e}=this;t.save(),t.beginPath(),t.arc(e+1,e+1,e,0,2*Math.PI),t.stroke(),t.closePath(),t.restore()}render(t,e){t.drawImage(this.canvas,e.x,e.y)}}class v{constructor(t,e,s,i,n){this.x=t,this.y=e,this.vx=s,this.vy=i,this.radius=n}update(t){const{x:e,y:s,vx:i,vy:n,radius:h}=this,a={x:e+i,y:s+n};(a.x>t.maxX-h*2||a.x<t.minX)&&(this.vx=-i),(a.y>t.maxY-h*2||a.y<t.minY)&&(this.vy=-n),this.x=a.x,this.y=a.y}render(t){const{radius:e,x:s,y:i}=this;t.save(),t.beginPath(),t.arc(s,i,e,0,2*Math.PI),t.stroke(),t.closePath(),t.restore()}}class f{constructor(t,e){this.rootElement=t,this.useCache=!!e,this.shapeMap=null,this.raf=null,this.circles=[],this.circleRadius=20,this.useCache&&(this.bufferCanvas=new l(this.circleRadius));const s=document.createElement("canvas");this.canvas=s,this.ctx=s.getContext("2d"),this.rootElement.appendChild(s),this.updateCanvasSize()}getCanvasSize(){const t=this.rootElement,e=t.clientWidth,s=t.clientHeight,i=window.devicePixelRatio;return{width:e,height:s,dprWidth:e*i,dprHeight:s*i}}updateCanvasSize(){const t=this.canvas,{width:e,height:s,dprWidth:i,dprHeight:n}=this.getCanvasSize();this.width=i,this.height=n,this.boundary={minX:0,minY:0,maxX:i,maxY:n},t.width=i,t.height=n,t.style.cssText=`width:${e}px;height:${s}px;`,this.createCircles()}createCircles(){const{width:t,height:e,circleRadius:s}=this,i=[],n=s;for(let h=0;h<1e4;h++){const a=r(n,t-n*2),c=r(n,e-n*2),x=r(-2,2),p=r(-2,2);i.push(new v(a,c,x,p,s))}this.circles=i}render(){const{ctx:t,width:e,height:s,circles:i,boundary:n,bufferCanvas:h,useCache:a}=this;t.clearRect(0,0,e,s);for(const c of i)c.update(n),a?h.render(t,c):c.render(t);this.raf=window.requestAnimationFrame(this.render.bind(this))}destroy(){window.cancelAnimationFrame(this.raf)}}const u=new f(d,!0);u.render(),C(()=>u.destroy())}),(d,l)=>(y(),b("div",{class:"box",ref_key:"boxElementRef",ref:o},null,512))}};export{R as default};
