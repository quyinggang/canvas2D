import{g as _}from"./index-894cb8bb.js";import{r as b,o as P,b as L,c as R}from"./index-b7bb8ac5.js";const k={__name:"Panzoom",setup(B){const x=b(null);return P(()=>{const m=x.value,o=m.getBoundingClientRect();class f{constructor(){this.matrix=[1,0,0,1,0,0]}updateMatrix(t){this.matrix=t}multiply(t){const e=this.matrix,s=e[0]*t[0]+e[2]*t[1],n=e[1]*t[0]+e[3]*t[1],i=e[0]*t[2]+e[2]*t[3],c=e[1]*t[2]+e[3]*t[3],d=e[0]*t[4]+e[2]*t[5]+e[4],l=e[1]*t[4]+e[3]*t[5]+e[5];e[0]=s,e[1]=n,e[2]=i,e[3]=c,e[4]=d,e[5]=l}}class C{constructor(t){this.domElement=document.createElement("canvas"),this.ctx=this.domElement.getContext("2d"),this.setCanvasSize(t),this.setCanvasAttrs(),this.ctx.scale(t.pixel,t.pixel)}setCanvasSize(t){const{width:e,height:s,pixel:n}=t;this.width=e*n,this.height=s*n,this.styleWidth=e,this.styleHeight=s}setCanvasAttrs(){const{width:t,height:e,styleWidth:s,styleHeight:n,domElement:i}=this;i.width=t,i.height=e,i.style.cssText=`width:${s}px;height:${n}px;`}}class M{constructor(t){this.color=t.color,this.radius=t.radius,this.transform=new f,this.changeTransform(t)}changeTransform(t){this.transform.updateMatrix([1,0,0,1,t.x,t.y])}render(t){const{radius:e,color:s}=this;t.fillStyle=s,t.beginPath(),t.arc(0,0,e,0,2*Math.PI,!1),t.fill(),t.closePath()}}class T{constructor(t){const{width:e,height:s,container:n}=t;this.content=n,this.width=e,this.height=s,this.transform=new f,this.children=[],this.canvas=new C({pixel:window.devicePixelRatio,width:e,height:s}),this.mountCanvas()}mountCanvas(){this.content.appendChild(this.canvas.domElement)}changeTransform(t){this.transform.updateMatrix([t.scaleX,0,0,t.scaleY,t.translateX,t.translateY])}getTranslation(){const t=this.transform.matrix;return{x:t[4],y:t[5]}}getScale(){const t=this.transform.matrix;return{x:t[0],y:t[3]}}add(t){this.children.push(t)}render(){const{children:t,canvas:e}=this,{ctx:s,width:n,height:i}=e,c=this.transform.matrix;s.clearRect(0,0,n,i);for(const d of t){const l=new f;l.multiply(c),l.multiply(d.transform.matrix),s.save();const h=l.matrix;s.transform(h[0],h[1],h[2],h[3],h[4],h[5]),d.render(s),s.restore()}}}const r=new T({container:m,width:o.width,height:o.height});for(let a=0;a<10;a++)r.add(new M({x:Math.random()*o.width,y:Math.random()*o.height,radius:30,color:_()}));r.render();let u=null,p=!1;const g=1.01,w=a=>{if(!p)return;const t={x:a.pageX-o.left,y:a.pageY-o.top},e=r.getTranslation(),s=r.getScale();r.changeTransform({scaleX:s.x,scaleY:s.y,translateX:t.x-u.x+e.x,translateY:t.y-u.y+e.y}),r.render(),u=t},v=()=>{p=!1,window.removeEventListener("mouseup",v),window.removeEventListener("mousemove",w)},Y=a=>{const{pageX:t,pageY:e}=a;u={x:t-o.left,y:e-o.top},p=!0,window.addEventListener("mouseup",v),window.addEventListener("mousemove",w)},S=a=>{a.preventDefault();const{pageX:t,pageY:e,deltaY:s}=a,{x:n}=r.getScale(),i=r.getTranslation(),c=s>0?n*g:n/g,d=t-o.left,l=e-o.top,h=d-i.x,X=l-i.y,y={x:h/n,y:X/n},E={x:-y.x*c+d,y:-y.y*c+l};r.changeTransform({scaleX:c,scaleY:c,translateX:E.x,translateY:E.y}),r.render()};m.addEventListener("mousedown",Y),m.addEventListener("wheel",S,{passive:!1})}),(m,o)=>(L(),R("div",{class:"box",ref_key:"boxElementRef",ref:x},null,512))}};export{k as default};
