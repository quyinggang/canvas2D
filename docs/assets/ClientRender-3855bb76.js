import{a as y,g as E}from"./index-4243d227.js";import{_ as M,r as f,o as T,b as S,c as P,d as X,t as Y}from"./index-f31fb122.js";const k={class:"tip"},I={__name:"ClientRender",setup(L){const m=f(0),x=f(null);return T(()=>{const g=x.value;class d{constructor(){this.matrix=[1,0,0,1,0,0]}updateMatrix(t){this.matrix=t}multiply(t){const e=this.matrix,n=e[0]*t[0]+e[2]*t[1],s=e[1]*t[0]+e[3]*t[1],i=e[0]*t[2]+e[2]*t[3],h=e[1]*t[2]+e[3]*t[3],r=e[0]*t[4]+e[2]*t[5]+e[4],l=e[1]*t[4]+e[3]*t[5]+e[5];e[0]=n,e[1]=s,e[2]=i,e[3]=h,e[4]=r,e[5]=l}}class _{constructor(t){this.domElement=document.createElement("canvas"),this.ctx=this.domElement.getContext("2d"),this.setCanvasSize(t),this.setCanvasAttrs(),this.ctx.scale(t.pixel,t.pixel)}setCanvasSize(t){const{width:e,height:n,pixel:s}=t;this.width=e*s,this.height=n*s,this.styleWidth=e,this.styleHeight=n}setCanvasAttrs(){const{width:t,height:e,styleWidth:n,styleHeight:s,domElement:i}=this;i.width=t,i.height=e,i.style.cssText=`width:${n}px;height:${s}px;`}}class C{constructor(t){this.color=t.color,this.radius=t.radius,this.transform=new d,this.changeTransform(t)}changeTransform(t){this.transform.updateMatrix([1,0,0,1,t.x,t.y])}render(t){const{radius:e,color:n}=this;t.fillStyle=n,t.beginPath(),t.arc(0,0,e,0,2*Math.PI,!1),t.fill(),t.closePath()}getWidth(){return this.radius*2}getHeight(){return this.radius*2}}class b{constructor(t){const{container:e,useClientRender:n}=t,s=e.getBoundingClientRect();this.content=e,this.bounding=s,this.useClientRender=!!n,this.transform=new d,this.children=[];const i=t.pixel||window.devicePixelRatio;this.pixel=i,this.canvas=new _({pixel:i,width:s.width,height:s.height}),this.mountCanvas()}mountCanvas(){this.content.appendChild(this.canvas.domElement)}changeTransform(t){this.transform.updateMatrix([t.scaleX,0,0,t.scaleY,t.translateX,t.translateY])}getTranslation(){const t=this.transform.matrix;return{x:t[4],y:t[5]}}getScale(){const t=this.transform.matrix;return{x:t[0],y:t[3]}}add(t){this.children.push(t)}checkInClientArea(t,e){const n=this.bounding,s={x:n.width*.5,y:n.height*.5},i={x:e[4],y:e[5]},h=Math.abs(i.x-s.x),r=Math.abs(i.y-s.y);return h<(n.width+t.width)*.5&&r<(n.height+t.height)*.5}render(){const{children:t,canvas:e,useClientRender:n,bounding:s}=this,i=e.ctx,h=this.transform.matrix;m.value=0,i.clearRect(0,0,s.width,s.height);for(const r of t){const l=new d;l.multiply(h),l.multiply(r.transform.matrix);const c=l.matrix,R={width:r.getWidth(),height:r.getHeight()};(n?this.checkInClientArea(R,c):!0)&&(m.value+=1,i.save(),i.transform(c[0],c[1],c[2],c[3],c[4],c[5]),r.render(i),i.restore())}}}const a=new b({container:g,useClientRender:!0});for(let o=0;o<6e4;o++)a.add(new C({x:y(-1e4,1e4),y:y(-1e4,1e4),radius:30,color:E()}));a.render();let u=null,p=!1;const v=o=>{if(!p)return;const t=a.bounding,e={x:o.pageX-t.left,y:o.pageY-t.top},n=a.getTranslation(),s=a.getScale();a.changeTransform({scaleX:s.x,scaleY:s.y,translateX:e.x-u.x+n.x,translateY:e.y-u.y+n.y}),a.render(),u=e},w=()=>{p=!1,window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",w)};g.addEventListener("mousedown",o=>{const{pageX:t,pageY:e}=o,n=a.bounding;u={x:t-n.left,y:e-n.top},p=!0,window.addEventListener("mousemove",v),window.addEventListener("mouseup",w)})}),(g,d)=>(S(),P("div",{class:"box",ref_key:"boxElementRef",ref:x},[X("div",k,"可视区域渲染数量："+Y(m.value)+" / 60000",1)],512))}},H=M(I,[["__scopeId","data-v-cb11d40b"]]);export{H as default};
