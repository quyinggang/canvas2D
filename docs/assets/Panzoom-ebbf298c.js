import{g as P}from"./index-4243d227.js";import{r as S,o as X,b as _,c as b}from"./index-9a21a5d4.js";const W={__name:"Panzoom",setup(L){const g=S(null);return X(()=>{const m=g.value,o=m.getBoundingClientRect();class p{constructor(){this.matrix=[1,0,0,1,0,0]}updateMatrix(t){this.matrix=t}multiply(t){const e=this.matrix,s=e[0]*t[0]+e[2]*t[1],a=e[1]*t[0]+e[3]*t[1],i=e[0]*t[2]+e[2]*t[3],h=e[1]*t[2]+e[3]*t[3],d=e[0]*t[4]+e[2]*t[5]+e[4],l=e[1]*t[4]+e[3]*t[5]+e[5];e[0]=s,e[1]=a,e[2]=i,e[3]=h,e[4]=d,e[5]=l}}class E{constructor(t){this.domElement=document.createElement("canvas"),this.ctx=this.domElement.getContext("2d"),this.setCanvasSize(t),this.setCanvasAttrs(),this.ctx.scale(t.pixel,t.pixel)}setCanvasSize(t){const{width:e,height:s,pixel:a}=t;this.width=e*a,this.height=s*a,this.styleWidth=e,this.styleHeight=s}setCanvasAttrs(){const{width:t,height:e,styleWidth:s,styleHeight:a,domElement:i}=this;i.width=t,i.height=e,i.style.cssText=`width:${s}px;height:${a}px;`}}class C{constructor(t){this.color=t.color,this.radius=t.radius,this.transform=new p,this.changeTransform(t)}changeTransform(t){this.transform.updateMatrix([1,0,0,1,t.x,t.y])}render(t){const{radius:e,color:s}=this;t.fillStyle=s,t.beginPath(),t.arc(0,0,e,0,2*Math.PI,!1),t.fill(),t.closePath()}}class M{constructor(t){const{width:e,height:s,container:a}=t;this.content=a,this.width=e,this.height=s,this.transform=new p,this.children=[],this.canvas=new E({pixel:window.devicePixelRatio,width:e,height:s}),this.mountCanvas()}mountCanvas(){this.content.appendChild(this.canvas.domElement)}changeTransform(t){this.transform.updateMatrix([t.scaleX,0,0,t.scaleY,t.translateX,t.translateY])}getTranslation(){const t=this.transform.matrix;return{x:t[4],y:t[5]}}getScale(){const t=this.transform.matrix;return{x:t[0],y:t[3]}}add(t){this.children.push(t)}render(){const{children:t,canvas:e}=this,{ctx:s,width:a,height:i}=e,h=this.transform.matrix;s.clearRect(0,0,a,i);for(const d of t){const l=new p;l.multiply(h),l.multiply(d.transform.matrix),s.save();const c=l.matrix;s.transform(c[0],c[1],c[2],c[3],c[4],c[5]),d.render(s),s.restore()}}}const r=new M({container:m,width:o.width,height:o.height});for(let n=0;n<10;n++)r.add(new C({x:Math.random()*o.width,y:Math.random()*o.height,radius:30,color:P()}));r.render();let u=null,x=!1;const w=1.01,f=n=>{if(!x)return;const t={x:n.pageX-o.left,y:n.pageY-o.top},e=r.getTranslation(),s=r.getScale();r.changeTransform({scaleX:s.x,scaleY:s.y,translateX:t.x-u.x+e.x,translateY:t.y-u.y+e.y}),r.render(),u=t},v=()=>{x=!1,window.removeEventListener("mouseup",v),window.removeEventListener("mousemove",f)},T=n=>{const{pageX:t,pageY:e}=n;u={x:t-o.left,y:e-o.top},x=!0,window.addEventListener("mouseup",v),window.addEventListener("mousemove",f)},Y=n=>{n.preventDefault();const{pageX:t,pageY:e,deltaY:s}=n,a=t-o.left,i=e-o.top,{x:h}=r.getScale(),d=r.getTranslation(),l=s>0?h*w:h/w,c={x:(a-d.x)/h,y:(i-d.y)/h},y={x:a-c.x*l,y:i-c.y*l};r.changeTransform({scaleX:l,scaleY:l,translateX:y.x,translateY:y.y}),r.render()};m.addEventListener("mousedown",T),m.addEventListener("wheel",Y,{passive:!1})}),(m,o)=>(_(),b("div",{class:"box",ref_key:"boxElementRef",ref:g},null,512))}};export{W as default};
