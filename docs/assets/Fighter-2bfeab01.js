import{l as K}from"./index-4243d227.js";import{_ as $,r as P,o as ee,a as te,b as se,c as ne,d as X}from"./index-8e20fb21.js";const re=""+new URL("background-f4363e15.png",import.meta.url).href,ie=""+new URL("start-c0fff31c.png",import.meta.url).href,ae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAVCAYAAACUhcTwAAABpUlEQVR42mWSyytEYRjGn5QVW0t/gGJlr1mIc84sLJQkklgI/4PZSzGXwsJKJElCmHLZaHJJGlJnch+McStyK5fjeb/zpsGp33lnvvf53u/53vMC+sSCKInYOCUrEQftg+XIx9+nP4hSJkcpWiCJnioU/CQjFjq42Be10Mw4TL5IhuvdYRtFvsjGPgVrURsj/P3E+Mj4TlxWbokFUIiwhV4uDJFnEZErJtfJpGyIOmgDXwOafCMHJE6myJ2IeGQX+Lrhwgd37jDOkEVyRu7JpRwpnh7ILpmTKtx9zPgqx9LrMk+qEVGCvuZlQSt45JpMk6TcGiw3yz9L5EIFGVabIFvii/kGqI8XFZwb076/tNhgpXoYc74grUdskkPpHeMtPXVCBSd6KxGkjD8HR5KjqElE20pKfazmXoCiChElSVbNx3USPG3FHrFhbuNfP66+pILLJm+Y7+igVkRjekTadN5vrKvT4HEaWiHNkl3m8/hmXZ2CT7PBQgAygbEqFFMQM83zK2RpuI5rZb+GL1yNSp0Gj59pPBRC3r/xlSmUpJlxC425uW+8/A4iw+qfOQAAAABJRU5ErkJggg==",oe=""+new URL("plane-619f3cdb.png",import.meta.url).href,he=""+new URL("enemy1-2b79edd4.png",import.meta.url).href,ce="data:image/png;base64,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",le=""+new URL("enemy2-a7760f58.png",import.meta.url).href,me=""+new URL("enemy2_down-799ab2ff.png",import.meta.url).href,ge=""+new URL("enemy3-be571fc5.png",import.meta.url).href,de=""+new URL("enemy3_down-e27ffbac.png",import.meta.url).href;const fe={__name:"Fighter",setup(ye){const N=P(null),Y=P(null),M=P(null);return ee(()=>{const C=N.value,v=M.value,A=Y.value,E=C.clientWidth/2,F=C.clientHeight,b=window.devicePixelRatio;v.style.cssText=`width:${E}px;height:100%;`,A.style.cssText=`width: ${E}px;height:100%`,v.width=b*E,v.height=b*F,A.width=b*E,A.height=b*F;const R=A.getBoundingClientRect(),D={left:R.left,top:R.top},x=v.getContext("2d"),a=A.getContext("2d");x.scale(b,b),a.scale(b,b);const g=E,c=F,d=10,w={default:-1,ready:0,started:1,progress:2,pause:3,over:4},r={bg:"bg",start:"start",plane:"plane",bullet:"bullet",enemy1:"enemy1",enemy2:"enemy2",enemy3:"enemy3"},k={easy:1,normal:2,middle:3,hard:4},T={[k.easy]:{[r.enemy1]:.6*d,[r.enemy2]:.3*d,[r.enemy3]:.1*d},[k.normal]:{[r.enemy1]:.5*d,[r.enemy2]:.4*d,[r.enemy3]:.1*d},[k.middle]:{[r.enemy1]:.4*d,[r.enemy2]:.5*d,[r.enemy3]:.1*d},[k.hard]:{[r.enemy1]:.3*d,[r.enemy2]:.4*d,[r.enemy3]:.3*d}},S={[r.enemy1]:{score:10,speed:1.8,life:20},[r.enemy2]:{score:40,speed:1.4,life:60},[r.enemy3]:{score:80,speed:1,life:100}},U={[r.bg]:re,[r.start]:ie,[r.bullet]:ae,[r.plane]:oe,[r.enemy1]:[he,ce],[r.enemy2]:[le,me],[r.enemy3]:[ge,de]},I=()=>{a.clearRect(0,0,g,c)},q=(f,e)=>{const t=e-f,s=Math.random();return Math.round(s*t+f)},Z=(f,e)=>f>=e[0]&&f<=e[1],L=(f,e)=>{const[t,s]=f,{tl:n,tr:i,bl:o,br:h}=e,l=t>=n[0]&&s>=n[1],m=t<=i[0]&&s>=i[1],u=t>=o[0]&&s<=o[1],y=t<=h[0]&&s<=h[1];return l&&m&&u&&y};class Q{constructor(e){this.image=e,this.raf=null,this.offset=0,this.speed=.75}renderFrame(){const{image:e}=this;x.clearRect(0,0,g,c),x.save(),x.translate(0,this.offset),x.drawImage(e,0,0,g,c),x.drawImage(e,0,-c,g,c),x.restore(),this.offset+=this.speed,this.offset>=c&&(this.offset=0)}scroll(){this.renderFrame(),this.raf=window.requestAnimationFrame(this.scroll.bind(this))}stop(){window.cancelAnimationFrame(this.raf),this.offset=0}}class V{constructor(e,t,s,n,i,o){this.image=e,this.x=t,this.y=s,this.width=e.width,this.height=e.height,this.type=n,this.speed=i,this.life=o,this.removable=!1}render(){if(this.removable)return;const{image:e,x:t,y:s}=this;a.drawImage(e,t,s)}renderExploded(e){if(this.removable)return;const{x:t,y:s}=this;a.drawImage(e,t,s)}attack(){this.removable||(this.y+=this.speed)}destroy(){this.removable=!0}hit(e){this.life=Math.max(0,this.life-e)}}class B{constructor(e,t,s){this.image=e,this.x=t,this.y=s,this.width=e.width,this.height=e.height,this.power=10,this.speed=8,this.removable=!1}render(){if(this.removable)return;const{image:e,x:t,y:s}=this;a.drawImage(e,t,s)}fly(){this.y-=this.speed}destroy(){this.removable=!0}}class j{constructor(e,t,s){this.image=e,this.x=t,this.y=s,this.width=e.width,this.height=e.height}render(){const{x:e,y:t,image:s}=this;a.drawImage(s,e,t)}updatePosition(e,t){this.x=e,this.y=t}}class J{constructor(e){this.state=w.default,this.score=0,this.progress=0,this.background=null,this.fighter=null,this.raf=null,this.level=e,this.enemies=[],this.bullets=[],this.bulletRate=0,this.imageMap=new Map,this.enemyStats={[r.enemy1]:0,[r.enemy2]:0,[r.enemy3]:0},this.enemyFrameLimit=T[this.level],this.load()}load(){this.renderProgress();const e=this.imageMap,t=Object.values(U).reduce((n,i)=>{const o=Array.isArray(i)?i.length:1;return n+o},0),s=Number(parseFloat(1/t).toPrecision(4));for(const[n,i]of Object.entries(U))if(Array.isArray(i)){const o=[];for(let h=0,l=i.length;h<l;h++){const m=i[h];K(m).then(u=>{o[h]=u,this.progress+=s})}e.set(n,o)}else K(i).then(o=>{e.set(n,o),this.progress+=s})}renderProgress(){const e=Math.ceil(this.progress*100),t=`${Math.min(100,e)}%`;a.clearRect(0,0,g,c),a.save(),a.font="30px arial",a.strokeStyle="rgba(0, 0, 0, 0.6)";const s=a.measureText(t).width;if(a.strokeText(t,(g-s)/2,c/2),a.restore(),e>=100){a.clearRect(0,0,g,c),this.progress=1,this.state=w.ready,this.createScene();return}window.requestAnimationFrame(this.renderProgress.bind(this))}createScene(){this.createBackground(),this.renderStartScreen(),this.bindClickEvent()}bindClickEvent(){A.addEventListener("click",this.startGame.bind(this))}renderStartScreen(){const t=this.imageMap.get(r.start);a.drawImage(t,(g-t.width)*.5,0)}finishGame(){I();const e=this.score;this.state=w.over,this.reset(),this.background.stop(),this.renderStartScreen(),window.cancelAnimationFrame(this.raf),alert(`游戏结束，本轮总得分：${e}`)}reset(){this.enemies=[],this.bullets=[],this.bulletRate=0,this.score=0,this.enemyStats={[r.enemy1]:0,[r.enemy2]:0,[r.enemy3]:0}}destroy(){this.background.stop(),window.cancelAnimationFrame(this.raf)}startGame(){this.state!==w.progress&&(I(),this.state=w.started,this.startCountDown().then(()=>{this.state=w.progress,this.background.scroll(),this.createFighter(),this.controlFighter(),this.renderGameFrame()}))}renderGameFrame(){I(),this.bulletRate+=1,this.enemies.length<=d&&this.createEnemies(),this.bulletRate%10===0&&this.createBullets(),this.refreshEnemies(),this.fighter.render(),this.refreshBullets(),this.hitEnemy(),this.renderScore(),this.checkIsGameOver(),this.state!==w.over&&(this.raf=requestAnimationFrame(this.renderGameFrame.bind(this)))}startCountDown(){return new Promise(e=>{let t=5;const s="5s倒计时开始，请准备！";a.save(),a.font="30px arial";const n=a.measureText(s).width;a.fillText(s,(g-n)/2,c/2),a.restore();const i=setInterval(()=>{if(I(),t<=1){clearInterval(i),e();return}a.save();const o=t.toString();a.font="60px arial",a.strokeStyle="rgba(0, 0, 0, 0.6)";const h=a.measureText(o).width;a.strokeText(t,(g-h)/2,c/2),a.restore(),t-=1},1e3)})}renderScore(){a.save(),a.font="30px arial",a.fillText(`分数：${this.score}`,10,30),a.restore()}createBackground(){const t=this.imageMap.get(r.bg),s=new Q(t);s.renderFrame(),this.background=s}createFighter(){const t=this.imageMap.get(r.plane),s=(g-t.width)/2,n=c-t.height;this.fighter=new j(t,s,n)}controlFighter(){const e=this.fighter;let t=!1;const s=e.width,n=e.height,i=[0,g-s],o=[0,c-n];A.addEventListener("mousedown",()=>{t=!0}),A.addEventListener("mousemove",h=>{if(!t)return;const l=h.pageX-D.left-s/2,m=h.pageY-R.top-n/2;e.updatePosition(Math.max(Math.min(l,i[1]),i[0]),Math.max(Math.min(m,o[1]),o[0]))}),A.addEventListener("mouseup",()=>{t=!1})}createBullets(){const{imageMap:e,fighter:t}=this,s={x:13+t.x,y:21+t.y},n={x:77+t.x,y:21+t.y},i=e.get(r.bullet);this.bullets.push(new B(i,s.x,s.y),new B(i,n.x,n.y))}refreshBullets(){const e=this.bullets,t=[];for(const s of e)s.fly(),s.y<0&&s.destroy(),s.removable||t.push(s),s.render();this.bullets=t}createEnemies(){const e=[],{imageMap:t,enemyStats:s,enemyFrameLimit:n}=this,i=[r.enemy1,r.enemy2,r.enemy3],o=t.get(i[0]),h=t.get(i[1]),l=t.get(i[2]),m=[o[0],h[0],l[0]];for(let u=0;u<2;u++){const y=Math.trunc(q(0,2)),p=i[y],G=m[y],{speed:O,life:z}=S[p],W=q(0,g-G.width),_=-G.height;s[p]<n[p]&&(s[p]+=1,e.push(new V(G,W,_,p,O,z)))}this.enemies.push(...e)}refreshEnemies(){const{enemies:e,imageMap:t}=this,s=[];for(const n of e)if(n.attack(),n.y>c&&this.destroyEnemy(n),!n.removable){const i=S[n.type].life,o=n.life<i,h=t.get(n.type);o?n.renderExploded(h[1]):n.render(),s.push(n)}this.enemies=s}destroyEnemy(e){this.enemyStats[e.type]-=1,e.destroy()}hitEnemy(){const{enemies:e,bullets:t}=this;for(const s of e){const{type:n,x:i,y:o,width:h,height:l}=s,m=[i,i+h],u=[o,o+l];for(const y of t)Z(y.x,m)&&Z(y.y,u)&&(y.destroy(),s.hit(y.power),s.life<=0&&(this.score+=S[n].score,this.destroyEnemy(s)))}}checkIsGameOver(){const e=this.enemies,{x:t,y:s,width:n,height:i}=this.fighter,o={tl:[t,s],tr:[t+n,s],bl:[t,s+i],br:[t+n,s+i]};for(const h of e){const{x:l,y:m,width:u,height:y}=h,p={tl:[l,m],tr:[l+u,m],bl:[l,m+y],br:[l+u,m+y]};if(L(o.tl,p)||L(o.tr,p)||L(o.bl,p)||L(o.br,p)){this.finishGame();break}}}}const H=new J(k.easy);te(()=>H.destroy())}),(C,v)=>(se(),ne("div",{class:"box",ref_key:"boxElementRef",ref:N},[X("canvas",{class:"backgroundCanvas",ref_key:"backgroundCanvasRef",ref:M},null,512),X("canvas",{class:"gameCanvas",ref_key:"gameCanvasRef",ref:Y},null,512)],512))}},Ae=$(fe,[["__scopeId","data-v-33672d6c"]]);export{Ae as default};
